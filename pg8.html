<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Verdana, Sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            overflow: hidden;
        }

        .shape {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: float 8s linear infinite;
        }
        .shape:nth-child(1) { width: 25px; height: 25px; animation-duration: 9s; }
        .shape:nth-child(2) { width: 35px; height: 35px; animation-duration: 12s; }
        .shape:nth-child(3) { width: 15px; height: 15px; animation-duration: 7s; }

        .shape.star {
            background-color: rgba(255, 223, 0, 0.6);
            clip-path: polygon(
                50% 0%, 61% 35%, 98% 35%,
                68% 57%, 79% 91%, 50% 70%,
                21% 91%, 32% 57%, 2% 35%,
                39% 35%
            );
        }

        @keyframes float {
            from {
                transform: translateY(100vh) scale(0.8) rotate(0deg);
                opacity: 0;
            }
            to {
                transform: translateY(-10vh) scale(1.2) rotate(360deg);
                opacity: 1;
            }
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.7);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 700px;
        }

        .next-button {
            display: inline-block;
            text-decoration: none;
            text-align: center;
            line-height: 36px;
            background-color: rgb(127, 70, 133);
            color: white;
            border: none;
            height: 36px;
            width: 120px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        .next-button:hover {
            background-color: rgb(150, 90, 160);
            transform: scale(1.1);
        }

        .center-image {
            width: 260px;
            display: block;
            margin: 20px auto;
        }

        .welcome-interface {
            font-weight: bold;
            font-style: italic;
            font-size: 35px;
            margin-bottom: 20px;
            color: #444;
        }

        .first-question {
            font-family: Verdana, Sans-serif;
            font-size: 22px;
            font-style: italic;
        }

        .topic-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .topic-item {
            flex: 0 0 45%;
            margin: 5px;
            text-align: left;
        }
        
        .topic-item input {
            margin-right: 10px;
        }
        
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }
        
        .topic-counter {
            margin-top: 15px;
            font-size: 16px;
            color: #555;
        }
    </style>
</head>
<body>

    <!-- Floating shapes -->
    <div class="shape" style="left: 10%; animation-delay: 0s;"></div>
    <div class="shape star" style="left: 30%; animation-delay: 2s;"></div>
    <div class="shape" style="left: 50%; animation-delay: 4s;"></div>
    <div class="shape star" style="left: 70%; animation-delay: 6s;"></div>
    <div class="shape" style="left: 90%; animation-delay: 8s;"></div>

    <div class="container">
        <p class="welcome-interface">Welcome to MathChamp!</p>

        <img src="image.png" alt="Centered Image" class="center-image">

        <p class="first-question">What topic do you want them to improvise in?</p>

        <div class="topic-container">
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Numbers and counting"> Numbers and counting</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Comparing & Sorting"> Comparing & Sorting</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Patterns, Shapes and Space"> Patterns, Shapes and Space</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Measurements"> Measurements</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Basic addition-subtraction"> Basic addition-subtraction</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Problem solving"> Problem solving</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Geometry"> Geometry</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Multiplication & Division"> Multiplication & Division</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Fractions and decimals"> Fractions and decimals</label>
            </div>
            <div class="topic-item">
                <label><input type="checkbox" name="topic" value="Data & Graphs"> Data & Graphs</label>
            </div>
        </div>

        <div class="topic-counter" id="topicCounter">0 topics selected</div>
        <div class="error-message" id="topicError"></div>
        
        <button class="next-button" id="topicNextBtn">Next</button>
    </div>

<script>
// Define all topics
const all_topics = [
    "Numbers and counting",
    "Comparing & Sorting",
    "Patterns, Shapes and Space",
    "Measurements",
    "Basic addition-subtraction",
    "Problem solving",
    "Geometry",
    "Multiplication & Division",
    "Fractions and decimals",
    "Data & Graphs"
];

// Function to get age-appropriate topics
function getAgeAppropriateTopics(age) {
    if (age === "3" || age === "4") {
        return all_topics.slice(0, 3); // First 3 topics
    } else if (age === "5" || age === "6") {
        return all_topics.slice(0, 6); // First 6 topics
    } else if (age === "7" || age === "8") {
        return all_topics; // All topics
    } else {
        return []; // Invalid age
    }
}

// Function to validate selected topics
function validateTopics(age, selectedTopics) {
    const ageAppropriate = getAgeAppropriateTopics(age);
    
    // Check if age is valid
    if (ageAppropriate.length === 0) {
        return { valid: false, message: "Invalid age. Please select between 3-8." };
    }
    
    // Check if at least one topic is selected
    if (selectedTopics.length === 0) {
        return { valid: false, message: "Please select at least one topic" };
    }
    
    // Check if all selected topics are age-appropriate
    for (const topic of selectedTopics) {
        if (!ageAppropriate.includes(topic)) {
            return { 
                valid: false, 
                message: `The topic "${topic}" is not recommended for age ${age}. Please select different topics.`
            };
        }
    }
    
    return { valid: true };
}

// Update topic counter
function updateTopicCounter() {
    const selectedCount = document.querySelectorAll('input[name="topic"]:checked').length;
    document.getElementById("topicCounter").textContent = `${selectedCount} topic${selectedCount !== 1 ? 's' : ''} selected`;
}

// Add event listeners to checkboxes
document.querySelectorAll('input[name="topic"]').forEach(checkbox => {
    checkbox.addEventListener('change', updateTopicCounter);
});

// Initialize counter
updateTopicCounter();

// Define redirection rules
function getRedirectionPage(age, selectedTopics) {
    // Sort topics for consistent comparison
    const sortedTopics = [...selectedTopics].sort();
    
    // Define redirection rules
    const rules = [
        // Age 3 rules
        { age: "3", topics: ["Numbers and counting"], page: "pg22.html" },
        { age: "3", topics: ["Comparing & Sorting"], page: "pg23.html" },
        { age: "3", topics: ["Patterns, Shapes and Space"], page: "pg24.html" },
        { age: "3", topics: ["Numbers and counting", "Comparing & Sorting"], page: "pg12.html" },
        { age: "3", topics: ["Numbers and counting", "Patterns, Shapes and Space"], page: "pg25.html" },
        { age: "3", topics: ["Comparing & Sorting", "Patterns, Shapes and Space"], page: "pg26.html" },
        { age: "3", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space"], page: "pg14.html" },
        
        // Age 4 rules
        { age: "4", topics: ["Numbers and counting"], page: "pg27.html" },
        { age: "4", topics: ["Comparing & Sorting"], page: "pg28.html" },
        { age: "4", topics: ["Patterns, Shapes and Space"], page: "pg29.html" },
        { age: "4", topics: ["Numbers and counting", "Comparing & Sorting"], page: "pg9.html" },
        { age: "4", topics: ["Numbers and counting", "Patterns, Shapes and Space"], page: "pg30.html" },
        { age: "4", topics: ["Comparing & Sorting", "Patterns, Shapes and Space"], page: "pg13.html" },
        { age: "4", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space"], page: "pg14.html" },
        
        // Age 5 rules
        { age: "5", topics: ["Numbers and counting"], page: "pg31.html" },
        { age: "5", topics: ["Comparing & Sorting"], page: "pg32.html" },
        { age: "5", topics: ["Patterns, Shapes and Space"], page: "pg33.html" },
        { age: "5", topics: ["Measurements"], page: "pg34.html" },
        { age: "5", topics: ["Basic addition-subtraction"], page: "pg35.html" },
        { age: "5", topics: ["Problem solving"], page: "pg36.html" },
        { age: "5", topics: ["Numbers and counting", "Comparing & Sorting"], page: "pg37.html" },
        { age: "5", topics: ["Numbers and counting", "Patterns, Shapes and Space"], page: "pg38.html" },
        { age: "5", topics: ["Comparing & Sorting", "Patterns, Shapes and Space"], page: "pg39.html" },
        { age: "5", topics: ["Comparing & Sorting", "Patterns, Shapes and Space", "Basic addition-subtraction"], page: "pg15.html" },
        { age: "5", topics: ["Patterns, Shapes and Space", "Basic addition-subtraction", "Problem solving"], page: "pg16.html" },
        { age: "5", topics: ["Measurements", "Basic addition-subtraction", "Problem solving"], page: "pg17.html" },
        { age: "5", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space", "Measurements", "Basic addition-subtraction", "Problem solving"], page: "pg40.html" },
        
        // Age 6 rules
        { age: "6", topics: ["Numbers and counting"], page: "pg41.html" },
        { age: "6", topics: ["Comparing & Sorting"], page: "pg42.html" },
        { age: "6", topics: ["Patterns, Shapes and Space"], page: "pg43.html" },
        { age: "6", topics: ["Measurements"], page: "pg44.html" },
        { age: "6", topics: ["Basic addition-subtraction"], page: "pg45.html" },
        { age: "6", topics: ["Problem solving"], page: "pg46.html" },
        { age: "6", topics: ["Patterns, Shapes and Space", "Basic addition-subtraction", "Problem solving"], page: "pg13.html" },
        { age: "6", topics: ["Basic addition-subtraction", "Problem solving", "Measurements"], page: "pg17.html" },
        { age: "6", topics: ["Basic addition-subtraction", "Problem solving", "Multiplication & Division"], page: "pg18.html" },
        { age: "6", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space", "Measurements", "Basic addition-subtraction", "Problem solving"], page: "pg47.html" },
        
        // Age 7 rules
        { age: "7", topics: ["Numbers and counting"], page: "pg48.html" },
        { age: "7", topics: ["Comparing & Sorting"], page: "pg49.html" },
        { age: "7", topics: ["Patterns, Shapes and Space"], page: "pg50.html" },
        { age: "7", topics: ["Measurements"], page: "pg51.html" },
        { age: "7", topics: ["Basic addition-subtraction"], page: "pg52.html" },
        { age: "7", topics: ["Problem solving"], page: "pg53.html" },
        { age: "7", topics: ["Geometry"], page: "pg54.html" },
        { age: "7", topics: ["Multiplication & Division"], page: "pg55.html" },
        { age: "7", topics: ["Fractions and decimals"], page: "pg56.html" },
        { age: "7", topics: ["Data & Graphs"], page: "pg57.html" },
        { age: "7", topics: ["Basic addition-subtraction", "Problem solving", "Multiplication & Division"], page: "pg18.html" },
        { age: "7", topics: ["Basic addition-subtraction", "Multiplication & Division", "Geometry"], page: "pg19.html" },
        { age: "7", topics: ["Basic addition-subtraction", "Multiplication & Division", "Fractions and decimals"], page: "pg20.html" },
        { age: "7", topics: ["Problem solving", "Multiplication & Division", "Fractions and decimals"], page: "pg20.html" },
        { age: "7", topics: ["Basic addition-subtraction", "Measurements", "Multiplication & Division"], page: "pg18.html" },
        { age: "7", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space", "Measurements", "Basic addition-subtraction", "Problem solving", "Geometry", "Multiplication & Division", "Fractions and decimals", "Data & Graphs"], page: "pg58.html" },
        
        // Age 8 rules
        { age: "8", topics: ["Numbers and counting"], page: "pg59.html" },
        { age: "8", topics: ["Comparing & Sorting"], page: "pg60.html" },
        { age: "8", topics: ["Patterns, Shapes and Space"], page: "pg61.html" },
        { age: "8", topics: ["Measurements"], page: "pg62.html" },
        { age: "8", topics: ["Basic addition-subtraction"], page: "pg63.html" },
        { age: "8", topics: ["Problem solving"], page: "pg64.html" },
        { age: "8", topics: ["Geometry"], page: "pg65.html" },
        { age: "8", topics: ["Multiplication & Division"], page: "pg66.html" },
        { age: "8", topics: ["Fractions and decimals"], page: "pg67.html" },
        { age: "8", topics: ["Data & Graphs"], page: "pg68.html" },
        { age: "8", topics: ["Data & Graphs", "Measurements", "Multiplication & Division"], page: "pg21.html" },
        { age: "8", topics: ["Data & Graphs", "Basic addition-subtraction", "Multiplication & Division"], page: "pg21.html" },
        { age: "8", topics: ["Numbers and counting", "Comparing & Sorting", "Patterns, Shapes and Space", "Measurements", "Basic addition-subtraction", "Problem solving", "Geometry", "Multiplication & Division", "Fractions and decimals", "Data & Graphs"], page: "pg69.html" }
    ];
    
    // Find matching rule
    for (const rule of rules) {
        if (rule.age === age && JSON.stringify(rule.topics.sort()) === JSON.stringify(sortedTopics)) {
            return rule.page;
        }
    }
    
    // Default redirection based on age if no specific rule matches
    if (age === "3" || age === "4") {
        return "pg9.html";
    } else if (age === "5" || age === "6") {
        return "pg15.html";
    } else if (age === "7" || age === "8") {
        return "pg18.html";
    } else {
        return "pg9.html"; // fallback
    }
}

document.getElementById("topicNextBtn").addEventListener("click", function(event) {
    event.preventDefault();

    const age = localStorage.getItem("childAge");
    const selectedTopics = Array.from(document.querySelectorAll('input[name="topic"]:checked'))
                            .map(cb => cb.value.trim());
    
    const errorElement = document.getElementById("topicError");
    
    // Validate topics
    const validation = validateTopics(age, selectedTopics);
    
    if (!validation.valid) {
        errorElement.textContent = validation.message;
        errorElement.style.display = "block";
        return;
    } else {
        errorElement.style.display = "none";
    }

    // Get redirection page and navigate
    const targetPage = getRedirectionPage(age, selectedTopics);
    window.location.href = targetPage;
});
</script>

</body>
</html>
