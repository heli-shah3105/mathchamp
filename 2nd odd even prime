<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numberland Quest: The Cosmic Scales!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

        :root {
            --poppy-pink: #FF6B9D;
            --bright-yellow: #FFD93D;
            --electric-blue: #6BCF7F;
            --deep-purple: #C56CF0;
            --orange: #FFA502;
            --dark-blue: #30336B;
        }

        /* MODIFIED: Added smooth scrolling behavior */
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* MODIFIED: Changed from center to flex-start */
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .game-container {
            width: 90%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-top: 40px; /* MODIFIED: Added margin from top */
        }

        h1 {
            color: var(--deep-purple);
            font-size: 2.5em;
            text-shadow: 2px 2px var(--bright-yellow);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .glimmer {
            font-size: 1.2em;
            color: var(--dark-blue);
            margin: 20px 0;
            min-height: 50px;
            background: #eef2ff;
            padding: 15px;
            border-radius: 15px;
            border: 2px dashed var(--electric-blue);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .game-area {
            display: none;
            margin-top: 20px;
        }

        .scales-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            perspective: 1000px;
        }

        .scale {
            width: 40%;
            height: 200px;
            border: 5px solid #333;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
        }

        .scale:hover {
            transform: scale(1.05) rotateY(5deg);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .scale h3 {
            margin: 0;
            z-index: 2;
        }

        .scale.even { background: linear-gradient(45deg, #f093fb, #f5576c); }
        .scale.odd { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        .scale.prime { background: linear-gradient(45deg, #43e97b, #38f9d7); }
        .scale.composite { background: linear-gradient(45deg, #fa709a, #fee140); }
        .scale.integer { background: linear-gradient(45deg, #30cfd0, #330867); }
        .scale.real { background: linear-gradient(45deg, #a8edea, #fed6e3); }

        .number-orb {
            width: 80px;
            height: 80px;
            background: var(--bright-yellow);
            color: var(--dark-blue);
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: 700;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: bob 2s infinite;
            cursor: grab;
        }

        @keyframes bob {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 700;
            z-index: 1000;
            animation: popIn 0.5s ease-out;
            pointer-events: none;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            80% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .feedback.correct { color: var(--electric-blue); text-shadow: 0 0 20px #fff; }
        .feedback.incorrect { color: var(--poppy-pink); text-shadow: 0 0 20px #fff; }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--electric-blue), var(--deep-purple));
            width: 0%;
            transition: width 0.5s ease;
            line-height: 30px;
            color: white;
            font-weight: 600;
        }

        .start-screen, .end-screen {
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, var(--poppy-pink), var(--orange));
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5em;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkleAnim 1.5s linear infinite;
            pointer-events: none;
        }

        @keyframes sparkleAnim {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="game-container" id="main-container">
        <h1>Numberland Quest!</h1>
        
        <!-- Start Screen -->
        <div id="start-screen" class="start-screen">
            <div class="glimmer">
                Glimmer: "Oh no! The silly Grumbles have mixed up all the numbers in Numberland! We need you, the Number Guardian, to use the Cosmic Scales to sort them out!"
            </div>
            <button class="btn" onclick="startGame()">Start Adventure!</button>
        </div>

        <!-- Game Area -->
        <div id="game-area" class="game-area">
            <div class="glimmer" id="glimmer-text"></div>
            <div class="number-orb" id="number-orb"></div>
            <div class="scales-container" id="scales-container">
                <!-- Scales will be generated by JavaScript -->
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="end-screen" style="display: none;">
            <h1 style="font-size: 3em; color: var(--electric-blue);">ðŸŽ‰ Quest Complete! ðŸŽ‰</h1>
            <div class="glimmer">
                Glimmer: "You did it! You've restored balance to all of Numberland! You are a true Number Guardian!"
            </div>
            <button class="btn" onclick="location.reload()">Play Again!</button>
        </div>
    </div>

    <script>
        // NEW: Voice Synthesis Setup
        const synth = window.speechSynthesis;
        let voices = [];

        function populateVoiceList() {
            voices = synth.getVoices().sort();
        }

        // This event is needed to load voices correctly in some browsers
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        function speak(text, callback) {
            if (synth.speaking) {
                console.error('SpeechSynthesis.speaking');
                return;
            }
            // Find a female voice, falling back to the default if not found
            const selectedVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('Samantha') || voice.name.includes('Google US English Female')) || voices[0];

            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.voice = selectedVoice;
            utterThis.pitch = 1.2; // Slightly higher pitch for a friendlier voice
            utterThis.rate = 0.9; // Slightly slower rate for kids
            utterThis.onend = callback;
            synth.speak(utterThis);
        }

        const levels = [
            {
                name: "The Forest of Twos",
                glimmerStory: "The Grumbles have mixed up the Buddy Numbers (Evens) and Solo Numbers (Odds)! Evens can be split into two equal teams, like 2, 4, 6... They end in 0, 2, 4, 6, or 8!",
                scales: [
                    { id: 'even', name: 'Even (Buddy Numbers)', class: 'even' },
                    { id: 'odd', name: 'Odd (Solo Numbers)', class: 'odd' }
                ],
                numbers: [3, 7, 12, 15, 20, 21, 8, 19, 44, 51, 60, 77],
                checkAnswer: (num, scaleId) => {
                    if (scaleId === 'even') return num % 2 === 0;
                    if (scaleId === 'odd') return num % 2 !== 0;
                    return false;
                }
            },
            {
                name: "The Crystal Caves of Primes",
                glimmerStory: "Deep underground, the Grumbles have trapped the Special Prime Crystals! Primes are super special; they can only be divided by 1 and themselves. Like 2, 3, 5, 7, 11...",
                scales: [
                    { id: 'prime', name: 'Prime Crystals', class: 'prime' },
                    { id: 'composite', name: 'Composite Rocks', class: 'composite' }
                ],
                numbers: [4, 6, 7, 9, 11, 12, 13, 16, 17, 18, 23, 25],
                checkAnswer: (num, scaleId) => {
                    const isPrime = (n) => {
                        if (n < 2) return false;
                        for (let i = 2; i <= Math.sqrt(n); i++) {
                            if (n % i === 0) return false;
                        }
                        return true;
                    };
                    if (scaleId === 'prime') return isPrime(num);
                    if (scaleId === 'composite') return !isPrime(num);
                    return false;
                }
            },
            {
                name: "The Sky City of Reals & Integers",
                glimmerStory: "The Grumbles have mixed up the Whole People (Integers) and the Fractional Sprites (other Reals)! Integers are whole numbers like -5, 0, 8. But EVERYONE is a Real Number!",
                scales: [
                    { id: 'integer', name: 'Integers (Whole People)', class: 'integer' },
                    { id: 'real', name: 'Real Numbers (Everyone!)', class: 'real' }
                ],
                numbers: [-4, 8, 1.5, -2.3, 0, 99, 10.0, 3.14, -10, 50, 2/3, 100],
                checkAnswer: (num, scaleId) => {
                    const isInt = Number.isInteger(num);
                    if (scaleId === 'integer') return isInt;
                    if (scaleId === 'real') return true; // All numbers in our set are real
                    return false;
                }
            }
        ];

        let currentLevelIndex = 0;
        let currentNumberIndex = 0;
        let currentLevel;
        let score = 0;

        function startGame() {
            populateVoiceList(); // Ensure voices are loaded
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            loadLevel(0);
        }

        function loadLevel(levelIndex) {
            if (levelIndex >= levels.length) {
                showEndScreen();
                return;
            }

            currentLevelIndex = levelIndex;
            currentNumberIndex = 0;
            currentLevel = levels[levelIndex];
            score = 0;
            
            const glimmerText = document.getElementById('glimmer-text');
            glimmerText.innerHTML = `Glimmer: "${currentLevel.glimmerStory}"`;
            
            // NEW: Speak the level introduction
            speak(currentLevel.glimmerStory, () => {
                // Scroll down to the game area after the intro is spoken
                document.getElementById('main-container').scrollIntoView({ behavior: 'smooth' });
            });
            
            const scalesContainer = document.getElementById('scales-container');
            scalesContainer.innerHTML = ''; // Clear previous scales
            
            currentLevel.scales.forEach(scale => {
                const scaleDiv = document.createElement('div');
                scaleDiv.className = `scale ${scale.class}`;
                scaleDiv.id = scale.id;
                scaleDiv.innerHTML = `<h3>${scale.name}</h3>`;
                scaleDiv.onclick = () => checkAnswer(scale.id);
                scalesContainer.appendChild(scaleDiv);
            });

            updateProgress();
            displayNextNumber();
        }

        function displayNextNumber() {
            if (currentNumberIndex >= currentLevel.numbers.length) {
                setTimeout(() => loadLevel(currentLevelIndex + 1), 1500);
                return;
            }

            const number = currentLevel.numbers[currentNumberIndex];
            const orb = document.getElementById('number-orb');
            orb.textContent = number;
            // Re-trigger animation
            orb.style.animation = 'none';
            setTimeout(() => orb.style.animation = 'bob 2s infinite', 10);
            
            // NEW: Speak the current number
            speak(`The number is... ${number}`);
        }

        function checkAnswer(scaleId) {
            const number = currentLevel.numbers[currentNumberIndex];
            const isCorrect = currentLevel.checkAnswer(number, scaleId);
            
            showFeedback(isCorrect);
            if (isCorrect) {
                score++;
                createSparkles(event.target);
                // NEW: Speak positive feedback
                speak(`Yes! Well done!`);
            } else {
                // NEW: Speak gentle correction
                speak(`Oops! Not quite. Let's try the next one.`);
            }

            currentNumberIndex++;
            updateProgress();
            setTimeout(displayNextNumber, 1500); // Give more time for feedback and voice
        }

        function showFeedback(isCorrect) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackDiv.textContent = isCorrect ? 'âœ¨ YES! âœ¨' : 'ðŸ˜¬ OOPS! ðŸ˜¬';
            document.body.appendChild(feedbackDiv);
            setTimeout(() => feedbackDiv.remove(), 1000);
        }
        
        function updateProgress() {
            const progress = (currentNumberIndex / currentLevel.numbers.length) * 100;
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
        }

        function showEndScreen() {
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            // NEW: Speak the ending message
            speak("You did it! You've restored balance to all of Numberland! You are a true Number Guardian!");
        }

        function createSparkles(element) {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    const rect = element.getBoundingClientRect();
                    sparkle.style.left = `${rect.left + rect.width / 2 + (Math.random() - 0.5) * 50}px`;
                    sparkle.style.top = `${rect.top + rect.height / 2}px`;
                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1500);
                }, i * 50);
            }
        }
    </script>
</body>
</html>
